# Story 5.2: Implement Chat UI Screen

## Status
Draft

## Story
**As a** Developer,
**I want** To implement the **Chat UI screen** with the "ultra-modern" aesthetic,
**So that** Users can interactively query documents through a conversational interface.

## Acceptance Criteria
1. Chat screen/component created with message history display
2. Input field for user questions with submit functionality
3. Display of AI responses with proper formatting
4. Loading states during message processing
5. Error handling for failed queries
6. Matches overall ultra-modern theme and styling
7. Responsive design for desktop and tablet viewports

## Tasks / Subtasks

- [ ] Task 1: Create Chat Screen Structure (AC: 1)
  - [ ] Create `app/chat/[sessionId]/page.tsx`
  - [ ] Set up chat layout with message area and input section
  - [ ] Create message history container (scrollable)
  - [ ] Create input area (fixed at bottom)
  - [ ] Add session validation (redirect if invalid)

- [ ] Task 2: Implement Message Display (AC: 1, 2)
  - [ ] Create message component for user messages
  - [ ] Create message component for AI responses
  - [ ] Differentiate user vs AI messages visually
  - [ ] Add timestamps to messages
  - [ ] Implement auto-scroll to latest message
  - [ ] Handle long messages with proper text wrapping

- [ ] Task 3: Implement Chat Input (AC: 2)
  - [ ] Create text input field for questions
  - [ ] Add submit button
  - [ ] Enable Enter key to submit
  - [ ] Disable input during message processing
  - [ ] Clear input after successful submission
  - [ ] Add character limit indicator (optional)

- [ ] Task 4: Implement Loading States (AC: 4)
  - [ ] Show typing indicator when AI is responding
  - [ ] Disable input during processing
  - [ ] Add visual feedback for message sending
  - [ ] Handle loading state gracefully

- [ ] Task 5: Implement Error Handling (AC: 5)
  - [ ] Display error messages in chat
  - [ ] Handle network failures
  - [ ] Handle API errors
  - [ ] Allow retry on failed messages
  - [ ] Show user-friendly error messages

- [ ] Task 6: Apply Ultra-Modern Styling (AC: 6)
  - [ ] Style message bubbles (user vs AI)
  - [ ] Add subtle shadows and borders
  - [ ] Use consistent color palette
  - [ ] Add smooth transitions for new messages
  - [ ] Polish input area styling
  - [ ] Ensure high readability

- [ ] Task 7: Implement Responsive Design (AC: 7)
  - [ ] Test on desktop viewport
  - [ ] Test on tablet viewport
  - [ ] Adjust message bubble widths
  - [ ] Ensure input area is accessible
  - [ ] Test scrolling behavior

- [ ] Task 8: Add Navigation (AC: 1)
  - [ ] Add "Back to Results" link/button
  - [ ] Add header with document context
  - [ ] Integrate with main navigation

- [ ] Task 9: Manual Testing (AC: 1-7)
  - [ ] Test sending messages
  - [ ] Test receiving responses
  - [ ] Test error scenarios
  - [ ] Test loading states
  - [ ] Test responsive behavior
  - [ ] Test navigation
  - [ ] Verify styling consistency

## Dev Notes

### Architecture Context

**Chat Endpoint:**
[Source: architecture/5-api-endpoints.md]
- `POST /api/v1/chat/{session_id}`
- Request: `ChatRequest(message: str)`
- Response: `ChatMessage(role: str, content: str, provenance: Optional[List[dict]])`

**Note:** Chat endpoint is optional for MVP. If not implemented in backend (Story 5.0), use mock responses for UI development.

### Screen Specifications

**From docs/front-end-spec.md:**

**Chat Screen Requirements:**
- Message history area (scrollable, auto-scroll to bottom)
- User messages aligned right
- AI messages aligned left
- Input field at bottom (fixed position)
- Submit button or Enter key to send
- Typing indicator while AI responds
- Error messages displayed inline
- Session context displayed in header

### UI Reference

**Review Before Implementation:**
Frontend UI guide templates in: `frontend/frontend-ui-guide/`

Look for chat interface examples for styling reference.

### Component Structure

Suggested component organization:
- `app/chat/[sessionId]/page.tsx` - Main chat page
- `components/chat/MessageBubble.tsx` - Individual message display
- `components/chat/ChatInput.tsx` - Input field and submit
- `components/chat/TypingIndicator.tsx` - Loading state
- `components/chat/ChatHeader.tsx` - Session context header

### Message State Management

**Client-Side State:**
- Message history array
- Current input value
- Loading state
- Error state
- Session information

**Message Format:**
Each message should include:
- Role (user or assistant)
- Content (text)
- Timestamp
- Optional: Provenance data for AI responses

### API Integration

For this story, implement UI with placeholder/mock chat functionality. Full backend integration happens in Story 5.3.

Mock response pattern:
- User sends message
- Show typing indicator
- After delay, display mock AI response
- Continue conversation flow

### Styling Requirements

**Message Bubbles:**
- User messages: Right-aligned, primary color background
- AI messages: Left-aligned, muted background
- Rounded corners
- Adequate padding
- Clear typography

**Input Area:**
- Fixed at bottom of screen
- Full width with padding
- Clear focus states
- Disabled state during processing

**Scrolling:**
- Auto-scroll to latest message
- Smooth scroll behavior
- Maintain scroll position when typing

### Responsive Considerations

**Desktop:**
- Max width for message bubbles (60-70% of container)
- Comfortable reading width

**Tablet:**
- Adjust bubble widths
- Ensure input is accessible
- Touch-friendly targets

### Dependencies

**Depends On:**
- Story 5.1 (shared components and styling)
- Story 5.0 (chat endpoint - optional for MVP)

**Enables:**
- Story 5.3 (full backend integration)

## Testing

**Manual Testing Checklist:**
- [ ] Chat screen loads correctly
- [ ] Can send messages
- [ ] Messages display in correct order
- [ ] User vs AI messages visually distinct
- [ ] Typing indicator shows during processing
- [ ] Error messages display correctly
- [ ] Auto-scroll works
- [ ] Input clears after send
- [ ] Navigation works
- [ ] Responsive on different viewports
- [ ] Styling matches theme

**Browser Testing:**
- Chrome (latest)
- Firefox (latest)
- Safari (latest)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-21 | 1.0 | Initial story creation for Epic 5 | Scrum Master (Bob) |

## Dev Agent Record
_To be filled by Dev Agent during implementation_

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_
